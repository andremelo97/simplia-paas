# Sistema de Quotas de Transcri√ß√£o (Speech-to-Text)

## üìã Vis√£o Geral

Sistema de controle de uso e cobran√ßa de transcri√ß√£o de √°udio para texto (STT - Speech-to-Text), com quotas mensais configur√°veis por tenant. Permite diferentes planos (Starter, Basic, VIP, Custom) com limites flex√≠veis e monitoramento de custos em tempo real.

---

## üéØ Objetivos

1. **Controlar custos** - Evitar gastos excessivos com API de transcri√ß√£o externa
2. **Flexibilidade** - Oferecer planos diferentes (Starter, Basic, VIP, Custom) com limites din√¢micos por plano
3. **Transpar√™ncia** - Admin do tenant visualiza uso e custos no Hub
4. **Gest√£o centralizada** - Equipe interna configura planos via Internal Admin
5. **Escalabilidade** - Arquitetura preparada para trocar fornecedor STT sem reescrever c√≥digo
6. **Self-Service** - Usu√°rios VIP podem configurar seus pr√≥prios limites customizados no Hub

---

## üí≥ Separa√ß√£o de Precifica√ß√£o (IMPORTANTE)

Este sistema de quotas de transcri√ß√£o √© **arquiteturalmente separado** do sistema de precifica√ß√£o de assinaturas.

### **Tabela `application_pricing` (N√ÉO AFETADA)**

**O que √©:**
- Tabela CORE que armazena o pre√ßo da assinatura do aplicativo TQ por tipo de usu√°rio
- Exemplo: Admin TQ = R$50/m√™s, Manager TQ = R$30/m√™s, Operations TQ = R$20/m√™s

**Onde fica o snapshot:**
- Quando acesso √© concedido via Internal Admin, valores s√£o "congelados" em `user_application_access`:
  - `price_snapshot NUMERIC(10,2)` - Valor no momento da concess√£o
  - `currency_snapshot VARCHAR(3)` - Moeda (BRL, USD, etc.)
  - `granted_cycle pricing_cycle_enum` - Ciclo (monthly/yearly)

**Por que n√£o √© afetado:**
- O sistema de quotas n√£o altera pre√ßos de assinatura
- Assinatura TQ ‚â† Quota de transcri√ß√£o
- S√£o cobran√ßas separadas e independentes

### **Sistema de Quotas de Transcri√ß√£o (NOVO)**

**O que √©:**
- Sistema adicional de controle de uso e custos de transcri√ß√£o (STT)
- Pacotes Basic e VIP com limites diferentes
- N√£o est√° conectado ao `application_pricing`

**Estrutura:**
```
Tenant tem:
‚îú‚îÄ‚îÄ 1 Assinatura TQ (via application_pricing)
‚îÇ   ‚îî‚îÄ‚îÄ Pre√ßo fixo por user type (Admin/Manager/Operations)
‚îÇ
‚îî‚îÄ‚îÄ 1 Quota de Transcri√ß√£o (via transcription_plans)
    ‚îî‚îÄ‚îÄ Limite de uso mensal (Basic/VIP)
```

**Exemplo Pr√°tico:**
```
Cl√≠nica Odontol√≥gica XYZ:

Assinatura TQ:
- 1 Admin: R$50/m√™s (application_pricing)
- 2 Managers: R$60/m√™s (2 √ó R$30)
- Total assinatura: R$110/m√™s

Quota de Transcri√ß√£o (separada):
- Plano Basic: 2.400 min/m√™s (40 horas)
- Custo estimado: $10.32/m√™s (uso de STT)
- Sem rela√ß√£o com os R$110 da assinatura
```

**Resultado:** A mudan√ßa deste sistema **N√ÉO afeta** `application_pricing` ou snapshots existentes.

---

## ‚öôÔ∏è Configura√ß√£o e Limites do Sistema

### **Sistema de Limites Din√¢micos**

O sistema **N√ÉO usa limites hardcoded**. Todos os limites s√£o definidos dinamicamente pelos planos configurados na tabela `transcription_plans`:

**Planos Dispon√≠veis (Seed Padr√£o):**
1. **Starter Plan**: 1.200 min/m√™s (20 horas) - Fixo, sem customiza√ß√£o, sem overage
2. **Basic Plan**: 2.400 min/m√™s (40 horas) - Fixo, sem customiza√ß√£o, sem overage
3. **VIP Plan**: Customiz√°vel (m√≠nimo definido pelo plano) - Permite custom limits + overage

**Planos Custom (Criados via Internal Admin):**
- Podem ter **APENAS** `allows_custom_limits=true` (ex: Premium com 5.000 min customiz√°veis)
- Podem ter **APENAS** `allows_overage=true` (ex: Standard com overage mas limite fixo)
- Podem ter **AMBOS** (VIP completo)

### **Regra de Valida√ß√£o: Custom Limit >= Plan Limit**

**Planos com custom limits N√ÉO podem ter limites customizados abaixo do limite base do plano:**
- Se o plano define `monthly_minutes_limit=2400`, ent√£o custom >= 2.400
- Se o plano define `monthly_minutes_limit=1200`, ent√£o custom >= 1.200
- Evita que clientes "contratem mais para usar menos"
- Valida√ß√£o obrigat√≥ria no frontend e backend usando `plan.monthlyMinutesLimit`

**Exemplo:**
```
‚úÖ V√°lido:
- Plano VIP (base: 2.400 min/m√™s)
- Custom limit: 5.000 min/m√™s

‚úÖ V√°lido:
- Plano Starter (base: 1.200 min/m√™s)
- Sem custom limits (usa o fixo de 1.200)

‚ùå Inv√°lido:
- Plano VIP (base: 2.400 min/m√™s)
- Custom limit: 1.500 min/m√™s ‚Üê N√ÉO PERMITIDO (abaixo do base)
```

---

## üí° Exemplos Pr√°ticos

### **Exemplo 1: Cl√≠nica Odontol√≥gica Pequena (Plano Basic)**

**Perfil:**
- 1 dentista
- 4 consultas/dia em m√©dia
- 30 minutos por consulta
- 20 dias √∫teis/m√™s

**Configura√ß√£o:**
- Plano: **Basic**
- Limite mensal: **2.400 minutos** (40 horas)
- Overage: **N√£o permitido**

**Cen√°rio Real:**
```
M√™s completo:
- 20 dias √ó 4 consultas √ó 30 min = 2.400 minutos
- Limite mensal: 2.400 minutos
- Resultado: 100% do limite utilizado, sem bloqueio

Custo:
- 2.400 min √ó $0.0052 = $12.48/m√™s
- Uso controlado e previs√≠vel
```

**Benef√≠cio:**
- Flexibilidade di√°ria (pode fazer 10 consultas num dia, 2 no outro)
- Custo controlado em ~$12.50/m√™s
- Sem bloqueios no meio do m√™s (se usar dentro do limite mensal)

---

### **Exemplo 2: Cl√≠nica M√©dica Grande (Plano VIP)**

**Perfil:**
- 3 m√©dicos
- 15 consultas/dia total
- 30 minutos por consulta em m√©dia
- 22 dias √∫teis/m√™s

**Configura√ß√£o:**
- Plano: **VIP**
- Limite mensal customizado: **10.000 minutos** (166.7 horas)
- Overage: **Permitido** (com alerta)

**Cen√°rio Real:**
```
M√™s t√≠pico:
- 22 dias √ó 15 consultas √ó 30 min = 9.900 minutos
- Limite mensal: 10.000 minutos
- Resultado: 99% utilizado, dentro do limite
- Custo: $51.48/m√™s (9900 min √ó $0.0052)

M√™s at√≠pico (alta demanda):
- 25 dias √ó 18 consultas √ó 30 min = 13.500 minutos
- Limite mensal: 10.000 minutos
- Overage: 3.500 minutos (35% acima do limite)
- Sistema processa normalmente (overage_allowed=true)
- Custo do m√™s: $70.20 (13500 min √ó $0.0052)
- Alerta enviado: "‚ö†Ô∏è Voc√™ ultrapassou 135% da quota mensal"
```

**Benef√≠cio:**
- Flexibilidade total (sem bloqueios)
- Overage permite picos sazonais
- Admin monitorado via alertas

---

### **Exemplo 3: Upgrade de Basic para VIP**

**Situa√ß√£o:**
Uma cl√≠nica come√ßa pequena e cresce:

**M√™s 1-3 (Basic):**
```
Configura√ß√£o inicial:
- Plano Basic (2.400 min/m√™s)
- 1 m√©dico, baixo volume
- Uso: ~1.800 min/m√™s
- Custo m√©dio: $7.74/m√™s
```

**M√™s 4 (Crescimento - ainda Basic):**
```
Novo cen√°rio:
- Contratou 2¬∫ m√©dico
- Tentam usar 4.500 min no m√™s
- Limite mensal: 2.400 min
- Resultado: Sistema bloqueia ap√≥s 2.400 min (dia 15 do m√™s)

Mensagem na tela:
"‚ùå Monthly transcription quota exceeded

Used: 2,400/2,400 minutes (40h 0min)
Your Basic plan allows 2,400 minutes per month.

Quota resets on March 1st.
Contact support to upgrade to VIP for custom limits."
```

**A√ß√£o tomada:**
```
Internal Admin acessa:
/transcription-plans ‚Üí Verifica planos dispon√≠veis
/tenants/123/edit ‚Üí Transcription Configuration

Antes:
- Plan: Basic (2400 min/m√™s fixo)
- Allow Overage: No

Depois:
- Plan: VIP
- Custom Monthly Limit: 6000 min (100h) ‚Üê M√≠nimo 2400
- Allow Overage: Yes

Resultado imediato:
- Cl√≠nica pode processar todas consultas
- Custo estimado: $25.80/m√™s
- Admin monitora uso no Hub
```

---

## üèóÔ∏è Arquitetura de Dados

### **1. Tabela: `transcription_plans` (Global)**

Armazena os planos dispon√≠veis no sistema (gerenciados via Internal Admin).

```sql
CREATE TABLE public.transcription_plans (
  id SERIAL PRIMARY KEY,
  slug VARCHAR(50) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  monthly_minutes_limit INTEGER,
  allows_custom_limits BOOLEAN DEFAULT false,
  cost_per_minute_usd NUMERIC(6,4) NOT NULL,
  active BOOLEAN DEFAULT true,
  description TEXT,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

**Dados iniciais (seed):**
| id | slug    | name         | monthly_limit | allows_custom | allows_overage | cost_per_min | active |
|----|---------|--------------|---------------|---------------|----------------|--------------|--------|
| 1  | starter | Starter Plan | 1200          | false         | false          | 0.0043       | true   |
| 2  | basic   | Basic Plan   | 2400          | false         | false          | 0.0043       | true   |
| 3  | vip     | VIP Plan     | 2400          | true          | true           | 0.0043       | true   |

**L√≥gica:**
- **Starter**: Limite fixo (1.200 min/m√™s ‚âà 20h), sem customiza√ß√£o, sem overage
- **Basic**: Limite fixo (2.400 min/m√™s ‚âà 40h), sem customiza√ß√£o, sem overage
- **VIP**: Limite base 2.400 min/m√™s, permite customiza√ß√£o (m√≠nimo 2.400) + overage
- **CRUD completo**: Internal Admin pode criar/editar/deletar/ativar/desativar planos
- **Custom Plans**: Admins podem criar planos com apenas custom limits OU apenas overage

---

### **2. Tabela: `tenant_transcription_config` (Global)**

Configura√ß√£o por tenant (qual plano + limite customizado se VIP).

```sql
CREATE TABLE public.tenant_transcription_config (
  id SERIAL PRIMARY KEY,
  tenant_id_fk INTEGER NOT NULL UNIQUE REFERENCES public.tenants(id),
  plan_id_fk INTEGER NOT NULL REFERENCES public.transcription_plans(id),
  custom_monthly_limit INTEGER NULL,
  transcription_language VARCHAR(10) DEFAULT 'pt-BR',
  overage_allowed BOOLEAN DEFAULT false,
  enabled BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

**IMPORTANTE:** O sistema **N√ÉO usa CHECK constraints hardcoded** no banco. A valida√ß√£o de limites √© feita dinamicamente no backend usando `plan.monthlyMinutesLimit`:

```javascript
// Backend validation (tenant-transcription-usage.js)
const planMinLimit = config.plan?.monthlyMinutesLimit || 2400;

if (parseInt(customMonthlyLimit) < planMinLimit) {
  return res.status(400).json({
    error: {
      code: 'CUSTOM_LIMIT_BELOW_PLAN_MINIMUM',
      message: `Custom limit (${customMonthlyLimit}) cannot be below plan's minimum limit of ${planMinLimit} minutes`
    }
  });
}
```

**Exemplo de registros:**
| tenant_id | plan_id | custom_monthly | overage_allowed | enabled | transcription_language |
|-----------|---------|----------------|-----------------|---------|------------------------|
| 1         | 1       | NULL           | false           | true    | pt-BR                  |
| 2         | 3       | 10000          | true            | true    | pt-BR                  |
| 3         | 2       | NULL           | false           | true    | en-US                  |
| 4         | 1       | NULL           | false           | true    | pt-BR                  |

**L√≥gica:**
- Se `plan_id=1` (Starter): `custom_monthly_limit` deve ser NULL, usa 1.200 min do plano
- Se `plan_id=2` (Basic): `custom_monthly_limit` deve ser NULL, usa 2.400 min do plano
- Se `plan_id=3` (VIP): `custom_monthly_limit` >= 2.400 (validado no backend dinamicamente)
- `overage_allowed=true`: processa mesmo ap√≥s exceder limite (mas registra alerta)
- `enabled=false`: desabilita transcri√ß√£o completamente
- `transcription_language`: pt-BR ou en-US (usado no Deepgram para monolingual pricing)

---

### **3. Tabela: `tenant_transcription_usage` (Global)**

Rastreamento de cada transcri√ß√£o processada.

```sql
CREATE TABLE public.tenant_transcription_usage (
  id SERIAL PRIMARY KEY,
  tenant_id_fk INTEGER NOT NULL REFERENCES public.tenants(id),
  transcription_id UUID,
  audio_duration_seconds INTEGER NOT NULL,
  stt_model VARCHAR(50) NOT NULL,
  stt_provider_request_id TEXT,
  cost_usd NUMERIC(10,4) NOT NULL,
  usage_date DATE NOT NULL,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_tenant_transcription_usage_tenant_date
  ON tenant_transcription_usage(tenant_id_fk, usage_date DESC);

CREATE INDEX idx_tenant_transcription_usage_month
  ON tenant_transcription_usage(tenant_id_fk, DATE_TRUNC('month', usage_date));
```

**Exemplo de registros:**
| tenant_id | transcription_id | duration_sec | stt_model | cost_usd | usage_date |
|-----------|------------------|--------------|-----------|----------|------------|
| 2         | uuid-123         | 2700         | nova-2    | 0.1935   | 2025-01-15 |
| 2         | uuid-456         | 1800         | nova-2    | 0.1290   | 2025-01-15 |
| 2         | uuid-789         | 3600         | nova-3    | 0.3120   | 2025-01-16 |

**Agrega√ß√µes:**
```sql
-- Uso mensal
SELECT SUM(audio_duration_seconds) / 60 as minutes_used
FROM tenant_transcription_usage
WHERE tenant_id_fk = 2
  AND usage_date >= DATE_TRUNC('month', CURRENT_DATE);
-- Resultado: 3.245 minutos (54h)
```

---

## üîí Fluxo de Bloqueio de Quota

### **Middleware: checkTranscriptionQuota**

Executado ANTES de iniciar transcri√ß√£o (`POST /api/tq/v1/transcriptions/:id/transcribe`).

**Importante:** O middleware **N√ÉO controla acesso** ao recurso de transcri√ß√£o. O controle de acesso √© feito via JWT `allowedApps` (se o usu√°rio tem acesso ao app TQ, ele pode transcrever). O middleware **APENAS valida quotas de uso**.

```javascript
async function checkTranscriptionQuota(req, res, next) {
  try {
    const tenantId = req.tenant?.id;

    if (!tenantId) {
      return res.status(401).json({
        error: { code: 401, message: 'Tenant authentication required' }
      });
    }

    // Tentar buscar configura√ß√£o do tenant (opcional)
    let config = null;
    let monthlyLimitMinutes = 60; // Default: 60 minutes/month
    let overageAllowed = false; // Default: no overage

    try {
      config = await TenantTranscriptionConfig.findByTenantId(tenantId);
      monthlyLimitMinutes = config.getEffectiveMonthlyLimit();
      overageAllowed = config.plan?.allowsOverage || config.overageAllowed || false;
    } catch (error) {
      if (error instanceof TenantTranscriptionConfigNotFoundError) {
        // Sem configura√ß√£o - usa limites default (60 min/m√™s, sem overage)
        console.log(`[Transcription Quota] No config for tenant ${tenantId}, using defaults (60 min/month, no overage)`);
      } else {
        throw error;
      }
    }

    // Buscar uso do m√™s atual
    const currentUsage = await TenantTranscriptionUsage.getCurrentMonthUsage(tenantId);

    // Verificar se quota foi excedida
    if (currentUsage.totalMinutes >= monthlyLimitMinutes) {
      // Verificar se overage √© permitido
      if (!overageAllowed) {
        return res.status(429).json({
          error: {
            code: 429,
            message: 'Monthly transcription quota exceeded',
            details: {
              used: currentUsage.totalMinutes,
              limit: monthlyLimitMinutes,
              remaining: 0
            }
          }
        });
      }
      // Se overage permitido, loga warning mas continua
      console.warn(`[Transcription Quota] Tenant ${tenantId} exceeded quota but overage allowed (${currentUsage.totalMinutes}/${monthlyLimitMinutes} minutes)`);
    }

    // Anexa informa√ß√µes de quota ao request para uso downstream
    req.transcriptionQuota = {
      config: config,
      usage: currentUsage,
      limit: monthlyLimitMinutes,
      remaining: Math.max(0, monthlyLimitMinutes - currentUsage.totalMinutes),
      hasExceeded: currentUsage.totalMinutes >= monthlyLimitMinutes
    };

    next();
  } catch (error) {
    console.error('[Transcription Quota Middleware] Error:', error);
    return res.status(500).json({
      error: { code: 500, message: 'Failed to check transcription quota' }
    });
  }
}
```

**Exemplo de bloqueio (resposta 429):**
```json
{
  "error": {
    "code": 429,
    "message": "Monthly transcription quota exceeded",
    "details": {
      "used": 2400,
      "limit": 2400,
      "remaining": 0
    }
  }
}
```

---

## üìä Registro de Uso (Webhook + Cron Job)

### **Fluxo de Registro de Custos:**

O sistema utiliza uma abordagem h√≠brida para garantir custos precisos:

1. **Webhook (Imediato)**: Calcula custo localmente baseado em detec√ß√£o de idioma
2. **Cron Job (Di√°rio)**: Atualiza com custo real da API de gerenciamento do Deepgram

### **1. Webhook Handler (Registro Imediato)**

Ap√≥s transcri√ß√£o completada, webhook registra uso com c√°lculo local:

```javascript
// Dentro do webhook handler (ap√≥s salvar transcript)

// 1. Calcular custo local baseado em detec√ß√£o de idioma
const audioDurationSeconds = Math.ceil(webhookData.metadata?.duration || 0);
const detectedLanguage = transcriptionData.detected_language || null;

// 2. Registrar na tabela de uso (fire and forget)
// Custo real ser√° atualizado mais tarde pelo cron job di√°rio
TenantTranscriptionUsage.create(parseInt(tenantId), {
  transcriptionId: transcriptionId,
  audioDurationSeconds: audioDurationSeconds,
  sttModel: DEFAULT_STT_MODEL, // 'nova-3'
  detectedLanguage: detectedLanguage, // 'pt', 'en', etc. (se multilingual)
  sttProviderRequestId: sttProviderRequestId, // request_id do Deepgram
  usageDate: new Date()
}).catch(error => {
  console.error(`[Transcription Usage] Failed to record usage for transcription ${transcriptionId}:`, error);
});

console.log(`[Webhook] ‚úÖ Usage logged with local cost calculation`);
```

**C√°lculo Local de Custo** (`TenantTranscriptionUsage.create()`):
```javascript
static async create(tenantId, data) {
  const {
    audioDurationSeconds,
    sttModel = DEFAULT_STT_MODEL,
    detectedLanguage = null,
    costUsd = null // Opcional: custo real do Deepgram
  } = data;

  // Usar custo fornecido OU calcular localmente
  let finalCostUsd;

  if (costUsd !== null) {
    // Usar custo real da API de gerenciamento do Deepgram
    finalCostUsd = costUsd;
  } else {
    // Calcular localmente baseado em detec√ß√£o de idioma
    const durationMinutes = audioDurationSeconds / 60;

    const costPerMinute = detectedLanguage
      ? MULTILINGUAL_COST_PER_MINUTE  // $0.0052/min (multilingual)
      : (MODEL_COSTS[sttModel] || DEFAULT_COST_PER_MINUTE); // $0.0043/min (monolingual)

    finalCostUsd = durationMinutes * costPerMinute;
  }

  // INSERT com custo calculado
  await database.query(`
    INSERT INTO public.tenant_transcription_usage (
      tenant_id_fk, transcription_id, audio_duration_seconds,
      stt_model, detected_language, stt_provider_request_id,
      cost_usd, usage_date
    ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)
  `, [
    tenantId, transcriptionId, audioDurationSeconds,
    sttModel, detectedLanguage, sttProviderRequestId,
    finalCostUsd.toFixed(4), usageDate
  ]);
}
```

### **2. Cron Job Di√°rio (Atualiza√ß√£o de Custos)**

**Objetivo**: Substituir c√°lculos locais por custos reais da API do Deepgram.

**Arquivo**: `src/server/jobs/updateTranscriptionCosts.js`

**Agendamento**: Todos os dias √†s 2 AM (0 2 * * *)

**Processo**:
```javascript
async function updateTranscriptionCosts() {
  console.log('[Cron] Starting transcription cost update job...');

  if (!DEEPGRAM_PROJECT_ID) {
    console.warn('[Cron] DEEPGRAM_PROJECT_ID not configured - skipping cost update');
    return;
  }

  // 1. Buscar registros das √∫ltimas 24 horas
  const query = `
    SELECT
      id, stt_provider_request_id, cost_usd as current_cost,
      audio_duration_seconds, detected_language
    FROM public.tenant_transcription_usage
    WHERE stt_provider_request_id IS NOT NULL
      AND usage_date >= NOW() - INTERVAL '24 hours'
    ORDER BY usage_date DESC
  `;

  const result = await database.query(query);

  // 2. Para cada registro, buscar custo real do Deepgram
  for (const row of result.rows) {
    const requestId = row.stt_provider_request_id;

    // Buscar custo via Deepgram Management API
    const costData = await deepgramService.getRequestCost(DEEPGRAM_PROJECT_ID, requestId);

    if (costData.usd !== null) {
      const realCost = costData.usd;
      const currentCost = parseFloat(row.current_cost);

      // 3. Atualizar APENAS se custo mudou significativamente (>$0.0001)
      if (Math.abs(realCost - currentCost) > 0.0001) {
        await database.query(`
          UPDATE public.tenant_transcription_usage
          SET cost_usd = $1, updated_at = NOW()
          WHERE id = $2
        `, [realCost.toFixed(4), row.id]);

        console.log(`[Cron] ‚úÖ Updated cost for request ${requestId}: ${currentCost.toFixed(4)} ‚Üí ${realCost.toFixed(4)}`);
      }
    } else {
      console.warn(`[Cron] ‚ö†Ô∏è Cost not available for request ${requestId} - keeping local calculation`);
    }

    // Delay de 50ms entre chamadas (evitar rate limit)
    await new Promise(resolve => setTimeout(resolve, 50));
  }

  console.log(`[Cron] Cost update complete: ${totalUpdated} updated, ${totalUnchanged} unchanged, ${totalFailed} failed`);
}
```

**Deepgram Management API** (`DeepgramService.getRequestCost()`):
```javascript
async getRequestCost(projectId, requestId) {
  const url = `https://api.deepgram.com/v1/projects/${projectId}/requests/${requestId}`;

  const response = await fetch(url, {
    method: 'GET',
    headers: {
      'Authorization': `Token ${this.apiKey}`,
      'Content-Type': 'application/json'
    }
  });

  const result = await response.json();
  const costUsd = result.response?.details?.usd || null;

  return {
    usd: costUsd,
    details: result.response?.details || {}
  };
}
```

**Benef√≠cios do Cron Job**:
- ‚úÖ N√£o bloqueia webhook (resposta imediata)
- ‚úÖ D√° 24h para Deepgram processar custos
- ‚úÖ Processamento em lote (mais eficiente)
- ‚úÖ Retry autom√°tico para falhas
- ‚úÖ Fallback para c√°lculo local se API indispon√≠vel

**Vari√°vel de Ambiente**:
```bash
DEEPGRAM_PROJECT_ID=your-deepgram-project-id
```

---

## üñ•Ô∏è Interface - Hub (Admin do Tenant)

### **P√°gina: Transcription Usage**

Rota: `/transcription-usage` (sidebar: "Transcription Usage", admin-only)

**Layout:**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  Transcription Usage                                          ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚ïë
‚ïë  ‚îÇ Monthly Usage   ‚îÇ  ‚îÇ Monthly Cost    ‚îÇ                    ‚ïë
‚ïë  ‚îÇ                 ‚îÇ  ‚îÇ                 ‚îÇ                    ‚ïë
‚ïë  ‚îÇ 1,850 / 2,400  ‚îÇ  ‚îÇ $7.96           ‚îÇ                    ‚ïë
‚ïë  ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë 77% ‚îÇ  ‚îÇ                 ‚îÇ                    ‚ïë
‚ïë  ‚îÇ                 ‚îÇ  ‚îÇ Basic Plan      ‚îÇ                    ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ Plan Information                                         ‚îÇ ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚ïë
‚ïë  ‚îÇ Current Plan: Basic Plan                                ‚îÇ ‚ïë
‚ïë  ‚îÇ Monthly Limit: 2,400 minutes (40 hours)                 ‚îÇ ‚ïë
‚ïë  ‚îÇ Remaining: 550 minutes (9.2 hours)                      ‚îÇ ‚ïë
‚ïë  ‚îÇ Overage: Not Allowed                                    ‚îÇ ‚ïë
‚ïë  ‚îÇ Resets: February 1st                                    ‚îÇ ‚ïë
‚ïë  ‚îÇ                                                          ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚ÑπÔ∏è  Contact support to upgrade to VIP plan for custom   ‚îÇ ‚ïë
‚ïë  ‚îÇ    limits and overage allowance.                        ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ Usage History (Last 30 Days)                            ‚îÇ ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚ïë
‚ïë  ‚îÇ Date     ‚îÇ Minutes    ‚îÇ Cost     ‚îÇ Transcriptions      ‚îÇ ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚ïë
‚ïë  ‚îÇ Jan 15   ‚îÇ 118.5      ‚îÇ $0.5096  ‚îÇ 4                   ‚îÇ ‚ïë
‚ïë  ‚îÇ Jan 14   ‚îÇ 95.2       ‚îÇ $0.4094  ‚îÇ 3                   ‚îÇ ‚ïë
‚ïë  ‚îÇ Jan 13   ‚îÇ 0          ‚îÇ $0.0000  ‚îÇ 0 (Weekend)         ‚îÇ ‚ïë
‚ïë  ‚îÇ Jan 12   ‚îÇ 110.8      ‚îÇ $0.4764  ‚îÇ 5                   ‚îÇ ‚ïë
‚ïë  ‚îÇ ...      ‚îÇ ...        ‚îÇ ...      ‚îÇ ...                 ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**API:**
```
GET /internal/api/v1/me/transcription-usage
Authorization: Bearer <token>

Response:
{
  "config": {
    "plan": "Basic Plan",
    "monthlyLimit": 2400,
    "overageAllowed": false,
    "allowsCustomLimits": false
  },
  "usage": {
    "currentMonth": {
      "minutesUsed": 1850,
      "limit": 2400,
      "remaining": 550,
      "percentage": 77,
      "costUsd": 7.955,
      "resetDate": "2025-02-01"
    }
  },
  "history": [
    { "date": "2025-01-15", "minutesUsed": "118.5", "costUsd": "0.5096", "transcriptionCount": 4 },
    ...
  ]
}
```

---

## ‚öôÔ∏è Interface - Hub Self-Service (VIP Users)

### **Se√ß√£o: Transcription Settings (dentro de Configurations)**

Rota: `/configurations` ‚Üí Drawer item: "Transcription" (admin-only)

**Localiza√ß√£o:** Dentro do drawer de Configurations do Hub (mesmo padr√£o que Branding)

**Objetivo:** Permitir que usu√°rios VIP configurem seus pr√≥prios limites sem depender do Internal Admin

**Layout (VIP User):**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  Transcription Settings                                       ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ Current Plan: VIP Plan                            ‚úÖ VIP ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë                                                               ‚ïë
‚ïë  Custom Monthly Limit (minutes) *                            ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ 10000                                                    ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë  Definido pelo seu plano                                     ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚òë Allow Overage Processing                                  ‚ïë
‚ïë  Continue processing transcriptions even after quota limit   ‚ïë
‚ïë  is reached (you will be billed for overage usage).          ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                            ‚ïë
‚ïë  ‚îÇ Save Changes ‚îÇ                                            ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                            ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚ÑπÔ∏è  VIP plan allows you to customize your transcription     ‚ïë
‚ïë     limits based on your business needs.                     ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**Layout (Basic User - Locked State):**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  Transcription Settings                                       ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ Current Plan: Basic Plan                                ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ üîí Custom Limits Not Available                          ‚îÇ ‚ïë
‚ïë  ‚îÇ                                                          ‚îÇ ‚ïë
‚ïë  ‚îÇ Your Basic plan includes:                               ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚Ä¢ Monthly Limit: 2,400 minutes                          ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚Ä¢ Overage: Not Allowed                                  ‚îÇ ‚ïë
‚ïë  ‚îÇ                                                          ‚îÇ ‚ïë
‚ïë  ‚îÇ üéØ Upgrade to VIP Plan to unlock:                       ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚Ä¢ Set custom monthly limit                              ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚Ä¢ Enable overage processing                             ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚Ä¢ Priority support                                      ‚îÇ ‚ïë
‚ïë  ‚îÇ                                                          ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                   ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚îÇ Contact Support   ‚îÇ                                   ‚îÇ ‚ïë
‚ïë  ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                   ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚ÑπÔ∏è  Contact support to upgrade to VIP plan and unlock       ‚ïë
‚ïë     custom transcription limits.                             ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**Valida√ß√µes Frontend:**
```javascript
// Valida√ß√£o din√¢mica baseada no plano selecionado
const planMinLimit = usage.plan.monthlyMinutesLimit; // Ex: 2400 para VIP

if (customMonthlyLimit < planMinLimit) {
  error = `Custom limit must be at least ${planMinLimit} minutes (defined by your plan)`;
}
```

**API (VIP Self-Service):**
```
PUT /internal/api/v1/me/transcription-config
Authorization: Bearer <token>
x-tenant-id: 123

Request (VIP user):
{
  "customMonthlyLimit": 10000,
  "overageAllowed": true
}

Response (Success):
{
  "data": {
    "config": {
      "planName": "VIP Plan",
      "customMonthlyLimit": 10000,
      "overageAllowed": true
    }
  },
  "meta": {
    "code": "TRANSCRIPTION_CONFIG_UPDATED",
    "message": "Transcription settings updated successfully"
  }
}

Response (Error - Below minimum):
{
  "error": {
    "code": "CUSTOM_LIMIT_BELOW_PLAN_MINIMUM",
    "message": "Custom limit (1500) cannot be below plan's minimum limit of 2400 minutes"
  },
  "meta": {
    "code": "CUSTOM_LIMIT_BELOW_PLAN_MINIMUM",
    "planMinLimit": 2400,
    "providedLimit": 1500
  }
}
```

**Valida√ß√µes Backend:**
```javascript
// 1. Verificar se o plano permite customiza√ß√£o
const config = await TenantTranscriptionConfig.findByTenantId(tenantId);

if (!config.canCustomizeLimits()) {
  return res.status(403).json({
    error: {
      code: 403,
      message: 'Your current plan does not allow custom limits. Please upgrade to VIP plan.'
    }
  });
}

// 2. Validar limite m√≠nimo dinamicamente baseado no plano
const planMinLimit = config.plan?.monthlyMinutesLimit || 2400;

if (parseInt(customMonthlyLimit) < planMinLimit) {
  return res.status(400).json({
    error: {
      code: 'CUSTOM_LIMIT_BELOW_PLAN_MINIMUM',
      message: `Custom limit (${customMonthlyLimit}) cannot be below plan's minimum limit of ${planMinLimit} minutes`
    },
    meta: {
      code: 'CUSTOM_LIMIT_BELOW_PLAN_MINIMUM',
      planMinLimit: planMinLimit,
      providedLimit: customMonthlyLimit
    }
  });
}
```

---

## üõ†Ô∏è Interface - Internal Admin

### **Nova P√°gina: Transcription Plans (CRUD)**

Rota: `/transcription-plans` (sidebar: "Transcription Plans")

**Objetivo:** Gerenciar planos de transcri√ß√£o dispon√≠veis no sistema.

**Layout (Listagem):**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  Transcription Plans                                          ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                        ‚ïë
‚ïë  ‚îÇ + Create Plan    ‚îÇ                                        ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                        ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ Plans List                                               ‚îÇ ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚ïë
‚ïë  ‚îÇ Name ‚îÇ Slug   ‚îÇ Limit   ‚îÇ Custom ‚îÇ Cost   ‚îÇ Actions    ‚îÇ ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚ïë
‚ïë  ‚îÇ Basic‚îÇ basic  ‚îÇ 2400    ‚îÇ No     ‚îÇ $0.0052‚îÇ Edit Delet ‚îÇ ‚ïë
‚ïë  ‚îÇ Plan ‚îÇ        ‚îÇ min/mo  ‚îÇ        ‚îÇ        ‚îÇ            ‚îÇ ‚ïë
‚ïë  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚ïë
‚ïë  ‚îÇ VIP  ‚îÇ vip    ‚îÇ Custom  ‚îÇ Yes    ‚îÇ $0.0052‚îÇ Edit Delet ‚îÇ ‚ïë
‚ïë  ‚îÇ Plan ‚îÇ        ‚îÇ         ‚îÇ        ‚îÇ        ‚îÇ            ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**Layout (Criar/Editar Plano):**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  Create Transcription Plan                                    ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  Plan Name *                                                  ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ Premium Plan                                             ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë                                                               ‚ïë
‚ïë  Slug *                                                       ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ premium                                                  ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë  URL-friendly identifier (lowercase, no spaces)              ‚ïë
‚ïë                                                               ‚ïë
‚ïë  Monthly Minutes Limit                                       ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ 5000                                                     ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë  Leave empty if plan allows custom limits                    ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚òë Allows Custom Limits                                      ‚ïë
‚ïë  Users can set their own monthly limits (VIP feature)        ‚ïë
‚ïë                                                               ‚ïë
‚ïë  Cost Per Minute (USD) *                                     ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ $0.0052 (Nova-3 Multilingual - System Standard)        ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë  (Read-only - System uses Nova-3 Multilingual model)        ‚ïë
‚ïë                                                               ‚ïë
‚ïë  Description                                                 ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ Mid-tier plan with fixed 5,000 min/month limit          ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚òë Active                                                     ‚ïë
‚ïë  Plan is available for assignment to tenants                 ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                               ‚ïë
‚ïë  ‚îÇ Save Plan    ‚îÇ  ‚îÇ Cancel ‚îÇ                               ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**API (CRUD Plans):**
```
# Listar planos
GET /internal/api/v1/transcription-plans
Response: { data: [{ id, slug, name, monthlyLimit, allowsCustomLimits, ... }] }

# Criar plano
POST /internal/api/v1/transcription-plans
Request: { name, slug, monthlyMinutesLimit, allowsCustomLimits, costPerMinuteUsd, description }
Response: { data: { id, ... }, meta: { code: 'PLAN_CREATED' } }

# Editar plano
PUT /internal/api/v1/transcription-plans/:id
Request: { name, monthlyMinutesLimit, allowsCustomLimits, costPerMinuteUsd, description, active }
Response: { data: { id, ... }, meta: { code: 'PLAN_UPDATED' } }

# Deletar plano (soft delete via active=false)
DELETE /internal/api/v1/transcription-plans/:id
Response: { meta: { code: 'PLAN_DELETED' } }
```

---

### **Se√ß√£o: Transcription Configuration (Tenant Edit)**

Localiza√ß√£o: `/tenants/:id/edit` ‚Üí Nova se√ß√£o ap√≥s "Entitlements"

**Objetivo:** Selecionar plano existente e configurar overage (n√£o cria planos aqui).

**Layout (Simplificado):**

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  Transcription Configuration                                  ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                               ‚ïë
‚ïë  Select Plan *                                                ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ VIP Plan ‚ñº                                               ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë  Options: Basic Plan (2400 min/mo), VIP Plan (custom)        ‚ïë
‚ïë                                                               ‚ïë
‚ïë  Custom Monthly Limit (minutes)                              ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ 10000                                                    ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïë  Only for plans with custom limits enabled. Minimum defined  ‚ïë
‚ïë  by selected plan.                                           ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚òë Allow Overage                                             ‚ïë
‚ïë  Process transcriptions even after exceeding quota.          ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚òë Enabled                                                    ‚ïë
‚ïë  Enable transcription service for this tenant.               ‚ïë
‚ïë                                                               ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                            ‚ïë
‚ïë  ‚îÇ Save Changes ‚îÇ                                            ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                            ‚ïë
‚ïë                                                               ‚ïë
‚ïë  Current Usage (January 2025)                                ‚ïë
‚ïë  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚ïë
‚ïë  ‚îÇ Total: 8,245 minutes (137.4 hours)                      ‚îÇ ‚ïë
‚ïë  ‚îÇ Cost: $35.45                                             ‚îÇ ‚ïë
‚ïë  ‚îÇ Transcriptions: 327                                      ‚îÇ ‚ïë
‚ïë  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

**Valida√ß√µes Frontend:**
```javascript
// Valida√ß√£o din√¢mica baseada no plano selecionado
if (selectedPlan.allowsCustomLimits && !customMonthlyLimit) {
  error = "This plan requires a custom monthly limit to be set";
}

if (selectedPlan.allowsCustomLimits && customMonthlyLimit < selectedPlan.monthlyMinutesLimit) {
  error = `Custom limit must be at least ${selectedPlan.monthlyMinutesLimit} minutes (plan minimum)`;
}

if (!selectedPlan.allowsCustomLimits && customMonthlyLimit) {
  error = "This plan does not allow custom limits";
}
```

**API:**
```
GET /internal/api/v1/tenants/:id/transcription-config
Response: {
  data: {
    planId, planName, customMonthlyLimit, overageAllowed, enabled
  }
}

PUT /internal/api/v1/tenants/:id/transcription-config
Request: { planId, customMonthlyLimit, overageAllowed, enabled }
Response: { meta: { code: 'TRANSCRIPTION_CONFIG_UPDATED' } }
```

---

## üìà M√©tricas e Monitoramento

### **Queries √∫teis para an√°lise:**

```sql
-- Top 10 tenants por uso mensal
SELECT
  t.name as tenant_name,
  SUM(ttu.audio_duration_seconds) / 60 as minutes_used,
  SUM(ttu.cost_usd) as total_cost,
  COUNT(*) as transcription_count
FROM public.tenant_transcription_usage ttu
JOIN public.tenants t ON ttu.tenant_id_fk = t.id
WHERE ttu.usage_date >= DATE_TRUNC('month', CURRENT_DATE)
GROUP BY t.name
ORDER BY minutes_used DESC
LIMIT 10;

-- Tenants pr√≥ximos do limite (> 80%)
SELECT
  t.name,
  COALESCE(ttc.custom_monthly_limit, tp.monthly_minutes_limit) as limit_minutes,
  SUM(ttu.audio_duration_seconds) / 60 as used_minutes,
  ROUND((SUM(ttu.audio_duration_seconds) / 60.0) / COALESCE(ttc.custom_monthly_limit, tp.monthly_minutes_limit) * 100, 2) as percentage
FROM public.tenant_transcription_usage ttu
JOIN public.tenants t ON ttu.tenant_id_fk = t.id
JOIN public.tenant_transcription_config ttc ON ttu.tenant_id_fk = ttc.tenant_id_fk
JOIN public.transcription_plans tp ON ttc.plan_id_fk = tp.id
WHERE ttu.usage_date >= DATE_TRUNC('month', CURRENT_DATE)
GROUP BY t.name, ttc.custom_monthly_limit, tp.monthly_minutes_limit
HAVING (SUM(ttu.audio_duration_seconds) / 60.0) / COALESCE(ttc.custom_monthly_limit, tp.monthly_minutes_limit) > 0.8
ORDER BY percentage DESC;

-- Custo total da plataforma (m√™s atual)
SELECT
  SUM(ttu.audio_duration_seconds) / 60 as total_minutes,
  SUM(ttu.cost_usd) as total_cost,
  COUNT(DISTINCT ttu.tenant_id_fk) as active_tenants
FROM public.tenant_transcription_usage ttu
WHERE ttu.usage_date >= DATE_TRUNC('month', CURRENT_DATE);
```

---

## üîÑ Migra√ß√£o e Rollout

### **Fase 1: Backend**
1. Criar migration com 3 tabelas
2. Criar constante `TRANSCRIPTION_BASIC_MONTHLY_LIMIT`
3. Seed com planos Basic e VIP
4. Implementar models (TranscriptionPlan, TenantTranscriptionConfig)
5. Implementar middleware `checkTranscriptionQuota`
6. Testar em ambiente de dev

### **Fase 2: Internal Admin**
1. Criar p√°gina CRUD de planos (`/transcription-plans`)
2. Criar se√ß√£o de configura√ß√£o em tenant edit
3. Configurar todos tenants existentes com plano Basic
4. Treinar equipe interna

### **Fase 3: Hub**
1. Criar p√°gina de visualiza√ß√£o de uso
2. Criar p√°gina de configura√ß√£o (VIP self-service)
3. Adicionar itens no sidebar (admin-only)
4. Comunicar tenants sobre novo recurso

### **Fase 4: TQ**
1. Ativar middleware de quota
2. Monitorar logs de bloqueio
3. Suporte reativo para tenants que excederem

---

## üö® Cen√°rios de Erro

### **Erro 1: Quota mensal excedida (429)**
```
Frontend mostra:
"‚ùå Monthly transcription quota exceeded

Your Basic plan allows 2,400 minutes (40 hours) per month.
Used this month: 2,400/2,400 minutes

Quota resets on February 1st.
Contact support to upgrade to VIP plan for higher limits."

[Contact Support] [OK]
```

### **Erro 2: Custom limit abaixo do m√≠nimo do plano (400)**
```
Frontend mostra:
"‚ùå Invalid custom limit

Custom limit (1500) cannot be below plan's minimum limit of 2400 minutes.
Please increase your limit to match your plan's minimum."

[OK]
```

### **Erro 3: Servi√ßo n√£o configurado (403)**
```
Frontend mostra:
"‚ö†Ô∏è Transcription service not available

Your account does not have transcription enabled.
Contact support to activate this feature."

[Contact Support]
```

---

## üí∞ C√°lculo de ROI

### **Cen√°rio: 10 tenants no primeiro m√™s**

| Tenant | Plano | Uso (min/m√™s) | Custo STT | Plano cobrado | Margem |
|--------|-------|---------------|-----------|---------------|--------|
| 1      | Basic | 2.400         | $10.32    | $29           | $18.68 |
| 2      | Basic | 2.100         | $9.03     | $29           | $19.97 |
| 3      | VIP   | 8.000         | $34.40    | $99           | $64.60 |
| 4      | Basic | 1.800         | $7.74     | $29           | $21.26 |
| 5      | Basic | 2.300         | $9.89     | $29           | $19.11 |
| 6      | VIP   | 12.000        | $51.60    | $149          | $97.40 |
| 7      | Basic | 2.200         | $9.46     | $29           | $19.54 |
| 8      | Basic | 2.000         | $8.60     | $29           | $20.40 |
| 9      | VIP   | 15.000        | $64.50    | $199          | $134.50|
| 10     | Basic | 2.400         | $10.32    | $29           | $18.68 |

**Total:**
- Custo STT: $215.86
- Receita planos: $649
- **Margem bruta: $433.14 (67%)**

---

## üìù Checklist de Implementa√ß√£o

### **Backend**
- [x] Migration: criar `transcription_plans` (com updated_at, allows_custom_limits, allows_overage)
- [x] Migration: criar `tenant_transcription_config` (SEM constraints hardcoded)
- [x] Migration: criar `tenant_transcription_usage`
- [x] Seed: popular `transcription_plans` (Starter 1200, Basic 2400, VIP 2400+)
- [x] Model: `TranscriptionPlan.js` (CRUD completo)
- [x] Model: `TenantTranscriptionConfig.js` (com valida√ß√£o din√¢mica via `plan.monthlyMinutesLimit`)
- [x] Middleware: `checkTranscriptionQuota.js` (usa `config.getEffectiveMonthlyLimit()` dinamicamente)
- [x] Modificar webhook: adicionar registro de uso
- [x] Rotas Hub: `GET /configurations/transcription-usage` (visualiza√ß√£o de uso)
- [x] Rotas Hub: `PUT /configurations/transcription-config` (self-service VIP com valida√ß√£o din√¢mica)
- [x] Rotas Internal Admin Plans: `GET /transcription-plans` (listar)
- [x] Rotas Internal Admin Plans: `POST /transcription-plans` (criar)
- [x] Rotas Internal Admin Plans: `PUT /transcription-plans/:id` (editar)
- [x] Rotas Internal Admin Plans: `DELETE /transcription-plans/:id` (deactivate)
- [x] Rotas Internal Admin Tenant: `GET /tenants/:id/transcription-config`
- [x] Rotas Internal Admin Tenant: `PUT /tenants/:id/transcription-config` (valida√ß√£o din√¢mica)
- [x] Valida√ß√µes din√¢micas: Todas valida√ß√µes usam `plan.monthlyMinutesLimit`, n√£o valores hardcoded

### **Frontend Hub**
- [x] P√°gina: `TranscriptionUsageConfiguration.tsx` (visualiza√ß√£o de uso + self-service)
- [x] Service: `transcriptionUsageService.ts`
- [x] Sidebar: item "Configurations" (admin-only)
- [x] Configurations Layout: Reutilizado para m√∫ltiplas configs
- [x] VIP Upgrade Card: Gradient styling com benefits list
- [x] Premium Features Card: Condicional baseado em `allowsCustomLimits` e `allowsOverage`
- [x] Alert Component: Variants `warning` e `gradient` com flex layout
- [x] Tradu√ß√£o i18n (pt-BR e en-US) - Removidas refer√™ncias hardcoded "(40 horas)"

### **Frontend Internal Admin**
- [x] P√°gina: `TranscriptionPlans.tsx` (CRUD completo de planos)
- [x] P√°gina: `CreateTranscriptionPlan.tsx` / `EditTranscriptionPlan.tsx` (formul√°rios de plano)
- [x] Service: `transcriptionPlansService.ts`
- [x] Se√ß√£o: `TenantTranscriptionConfiguration.tsx` (em tenant edit)
- [x] Sidebar: item "Transcription Plans" (nova aba)
- [x] Valida√ß√µes de plano din√¢micas (usa `plan.monthlyMinutesLimit`)

### **Testes**
- [ ] Teste unit√°rio: c√°lculo de custos por modelo
- [ ] Teste integra√ß√£o: bloqueio de quota mensal
- [ ] Teste integra√ß√£o: overage allowed
- [ ] Teste integra√ß√£o: VIP limite < 2400 bloqueado
- [ ] Teste E2E: fluxo completo (upload ‚Üí bloqueio ‚Üí visualiza√ß√£o Hub)
- [ ] Teste E2E: CRUD de planos no Internal Admin

---

## üéì Gloss√°rio

- **STT (Speech-to-Text)**: Tecnologia de convers√£o de √°udio em texto
- **Quota**: Limite de uso mensal
- **Overage**: Uso al√©m do limite configurado
- **Starter Plan**: Plano b√°sico com limite fixo de 1.200 min/m√™s (20h), n√£o customiz√°vel
- **Basic Plan**: Plano padr√£o com limite fixo de 2.400 min/m√™s (40h), n√£o customiz√°vel
- **VIP Plan**: Plano premium com limite base de 2.400 min/m√™s, customiz√°vel (permite custom limits + overage)
- **Custom Plans**: Planos criados via Internal Admin com apenas `allows_custom_limits` OU apenas `allows_overage`
- **Dynamic Validation**: Sistema de valida√ß√£o que usa `plan.monthlyMinutesLimit` ao inv√©s de valores hardcoded
- **Tenant**: Cliente/organiza√ß√£o na plataforma multi-tenant
- **Internal Admin**: Interface administrativa para equipe interna (Simplia)
- **Hub**: Portal self-service para admins dos tenants

---

## üìû Contato

Para d√∫vidas sobre implementa√ß√£o, contate o time de desenvolvimento.
